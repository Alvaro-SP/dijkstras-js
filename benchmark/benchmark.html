<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Benchmark</title>

        <!-- Bootstrap -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap-theme.min.css">
    </head>
    <body>
        <div class="container">
            <h1>Benchmark</h1>

            <ul>
                <li>100 x 100 Grid (10,000 cells).</li>
                <li>Each cell connects to all of it's surrounding cells horizontally, vertically, &amp; diagonally (78,808 connections).</li>
                <li>Each connection has an equal weight.</li>
                <li>Routing from 1,1 to 100,100.</li>
                <li>The algorithm is the same. The implementation is not.</li>
            </ul>

            <form class="form-horizontal">
                <label class="col-sm-offset-9 col-sm-1 control-label" for="runs">
                    Runs
                </label>
                <div class="col-sm-1">
                    <select name="runs" class="form-control">
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                        <option value="50">50</option>
                        <option value="100">100</option>
                    </select>
                </div>
                <div class="col-sm-1">
                    <button id="run" type="button" class="btn btn-default">Run</button>
                </div>
            </form>

            <table class="table">
                <thead>
                    <tr>
                        <th>Version</th>
                        <th>Result</th>
                        <th>Difference</th>
                        <th width="50%">Graph</th>
                    </tr>
                </thead>
                <tbody>
                    <tr id="row_master">
                        <td>
                            <strong>master</strong><br />
                            Current Dev
                        </td>
                        <td class="result"></td>
                        <td class="diff"></td>
                        <td class="graph"></td>
                    </tr>
                    <tr id="row_1_1_0">
                        <td>
                            <strong>1.1.0</strong><br />
                            Insertion Sort.
                        </td>
                        <td class="result"></td>
                        <td class="diff"></td>
                        <td class="graph"></td>
                    </tr>
                    <tr id="row_1_0_0">
                        <td>
                            <strong>1.0.0</strong><br />
                            Initial Version. Binary Sort.
                        </td>
                        <td class="result"></td>
                        <td class="diff"></td>
                        <td class="graph"></td>
                    </tr>
                </tbody>
            </table>

        </div>

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>

        <script src="graphgenerator.js"></script>

        <!-- Versions of Dijkstras JS -->
        <script src="../Dijkstras.js"></script>
        <script src="versions/v1.0.0.min.js"></script>
        <script src="versions/v1.1.0.min.js"></script>


        <script>
        $(function() {
            var VERSIONS = [
                    'master',
                    '1_1_0',
                    '1_0_0'
                ],
                RUNS = 1,
                SIZE_X = 100,
                SIZE_Y = 100,
                STATS = [],
                BUTTON = $('#run'),
                STATS = [];

            $('#run').click(function() {

                BUTTON.attr('disabled','disabled');
                BUTTON.text('Running...');

                RUNS = parseInt($('select[name*="runs"]').first().val());

                // Reset All Cells
                $('td.result').html('');
                $('td.graph').html('');
                $('td.diff').html('');

                setTimeout(function() {
                    RunTest(VERSIONS[0], 1);
                }, 10);
            });

            var RunTest = function (version, next) {
                var row = $('#row_' + version);
                var resultCell = $('td.result', row);

                resultCell.text('Running');

                var startNode = '1x1';
                var endNode = SIZE_X + 'x' + SIZE_Y;

                // Set Up
                var graph = generateGraph(SIZE_X, SIZE_Y),
                    className = (version == 'master') ? 'Dijkstras' : 'Dijkstras_' + version,
                    classObj = window[className],
                    dijkstras = new classObj();

                dijkstras.setGraph(graph);

                // Run Test X times
                var i = 0,
                    overallStart = performance.now();

                while (i < RUNS) {
                    dijkstras.getPath(startNode, endNode);
                    i++;
                }

                var overallEnd = performance.now(),
                    totalTime = overallEnd - overallStart,
                    avgTime = totalTime / RUNS,
                    avgTimeSecs = (avgTime / 1000).toFixed(3);

                STATS[version] = avgTime;

                resultCell.text(avgTimeSecs + 's');

                // Run next test, if there is one
                var running = false;
                if (typeof next !== 'undefined') {
                    if (typeof VERSIONS[next] !== 'undefined') {
                        running = true;
                        setTimeout(function() {
                            RunTest(VERSIONS[next], next+1);
                        }, 100);
                    }
                }

                // Update button
                if (!running) {
                    // Reset Run button
                    BUTTON.removeAttr('disabled');
                    BUTTON.text('Run');

                    // Do Graphs
                    var max = 0;

                    for (var v in STATS) {
                        if (STATS[v] > max) {
                            max = STATS[v];
                        }
                    }

                    for (var v in STATS) {
                        // Percent of slowest
                        var percent = (STATS[v] / max * 100).toFixed(0);
                        var progress = '';
                        progress += '<div class="progress">';
                        progress +=     '<div class="progress-bar progress-bar-danger" style="width: ' + percent + '%;">';
                        progress +=     '</div>';
                        progress += '</div>';

                        $('#row_' + v + ' td.graph').html(progress);

                        // Difference
                        var faster = '';
                        if (percent != 100) {
                            var howMuchFaster = (100/percent).toFixed(1);

                            if (howMuchFaster > 1.0) {
                                faster = howMuchFaster + 'x faster!';
                            }
                        }

                        $('#row_' + v + ' td.diff').html(faster);
                    }
                }
            }
        });

        </script>
    </body>
</html>
