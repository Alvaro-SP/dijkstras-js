<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Benchmark</title>

        <!-- Bootstrap -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap-theme.min.css">
    </head>
    <body>
        <div class="container">
            <h1>Benchmark</h1>

            <ul>
                <li>A 100 x 100 Grid</li>
                <li>Every cell connected to it's surrounding cells horizontally, vertically, and diagonally.</li>
                <li>Each connection has an equal weight.</li>
                <li>Routing from 1x1 to 100x100.</li>
                <li>Routing is run 5 times per verison.</li>
            </ul>

            <p class="text-center">
                <button id="run" type="button" class="btn btn-block btn-default">Run</button>
            </p>

            <table class="table">
                <thead>
                    <tr>
                        <th>Version</th>
                        <th>Result</th>
                        <th width="50%">Graph</th>
                    </tr>
                </thead>
                <tbody>
                    <tr id="row_1_1_0">
                        <td>
                            <strong>1.1.0</strong><br />
                            Uses Insertion Sort instead of binary sort.
                        </td>
                        <td class="results"></td>
                        <td class="graph"></td>
                    </tr>
                    <tr id="row_1_0_0">
                        <td>
                            <strong>1.0.0</strong><br />
                            Initial Version<
                        </td>
                        <td class="results"></td>
                        <td class="graph"></td>
                    </tr>
                </tbody>
            </table>

        </div>

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>

        <script src="graphgenerator.js"></script>

        <!-- Versions of Dijkstras JS -->
        <script src="versions/v1.0.0.min.js"></script>
        <script src="versions/v1.1.0.min.js"></script>


        <script>
        $(function() {
            var VERSIONS = [
                    '1_1_0',
                    '1_0_0'
                ],
                RUNS = 1,
                SIZE_X = 100,
                SIZE_Y = 100,
                STATS = [],
                BUTTON = $('#run'),
                STATS = [];

            $('#run').click(function() {

                BUTTON.attr('disabled','disabled');
                BUTTON.text('Running...');

                setTimeout(function() {
                    RunTest(VERSIONS[0], 1);
                }, 10);
            });

            var RunTest = function (version, next) {
                var row = $('#row_' + version);
                var resultCell = $('td.results', row);

                resultCell.text('Running...');

                var startNode = '1x1';
                var endNode = SIZE_X + 'x' + SIZE_Y;

                // Set Up
                var graph = generateGraph(SIZE_X, SIZE_Y),
                    className = 'Dijkstras_' + version,
                    classObj = window[className],
                    dijkstras = new classObj();

                dijkstras.setGraph(graph);

                // Run Test X times
                var i = 0,
                    overallStart = performance.now();

                while (i < RUNS) {
                    dijkstras.getPath(startNode, endNode);
                    i++;
                }

                var overallEnd = performance.now(),
                    totalTime = overallEnd - overallStart,
                    avgTime = totalTime / RUNS,
                    avgTimeSecs = (avgTime / 1000).toFixed(3);

                STATS[version] = avgTime;

                resultCell.text(avgTimeSecs + 's');

                // Run next test, if there is one
                var running = false;
                if (typeof next !== 'undefined') {
                    if (typeof VERSIONS[next] !== 'undefined') {
                        running = true;
                        setTimeout(function() {
                            RunTest(VERSIONS[next], next+1);
                        }, 10)
                    }
                }

                // Update button
                if (!running) {
                    BUTTON.removeAttr('disabled');
                    BUTTON.text('Run');


                    // Do Graphs
                    var max = 0;

                    for (var v in STATS) {
                        if (STATS[v] > max) {
                            max = STATS[v];
                        }
                    }

                    for (var v in STATS) {
                        var percent = (STATS[v] / max * 100).toFixed(2);

                        var progress = '';
                        progress += '<div class="progress">';
                        progress +=     '<div class="progress-bar progress-bar-danger" style="width: ' + percent + '%;">';
                        progress +=     '</div>';
                        progress += '</div>';

                        $('#row_' + v + ' td.graph').html(progress);

                    }
                }
            }
        });


        </script>
    </body>
</html>